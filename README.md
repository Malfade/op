# Скрипты оптимизации Windows

Набор скриптов для быстрой и безопасной оптимизации операционной системы Windows 10/11.

## Описание

Данный набор скриптов предназначен для комплексной оптимизации производительности Windows. Скрипты автоматически выполняют ряд оптимизаций, которые улучшают скорость работы системы, отключают ненужные службы и выполняют очистку диска.

## Возможности

- Оптимизация визуальных эффектов для повышения производительности
- Очистка временных файлов и оптимизация дисков
- Настройка файла подкачки для оптимальной производительности
- Отключение ненужных служб и компонентов Windows
- Оптимизация автозагрузки системы
- Настройка сетевых параметров для ускорения работы в интернете
- Создание резервных копий настроек перед изменением
- Полное логирование всех выполняемых действий

## Требования

- Windows 10 или Windows 11
- Права администратора для запуска скриптов

## Использование

1. Распакуйте архив со скриптами в отдельную папку
2. Запустите файл `Start-Optimizer.bat` от имени администратора
3. Следуйте инструкциям на экране
4. После завершения работы скрипта перезагрузите компьютер для применения всех оптимизаций

## Безопасность

- Скрипты создают резервные копии всех изменяемых параметров
- Перед запуском автоматически создается точка восстановления системы
- Все действия записываются в подробный лог для контроля
- Отключаются только некритичные компоненты, которые не влияют на стабильность

## Структура файлов

- `Start-Optimizer.bat` - основной файл запуска с проверкой прав администратора
- `WindowsOptimizer.ps1` - основной скрипт оптимизации на PowerShell
- `WindowsOptimizer_Logs/` - папка с логами выполнения (создается автоматически)
- `WindowsOptimizer_Backups/` - папка с резервными копиями (создается автоматически)

## Важные примечания

- Рекомендуется запускать оптимизацию на чистой установке Windows
- Перед запуском скриптов закройте все запущенные программы
- Процесс оптимизации может занять от 5 до 15 минут, в зависимости от мощности компьютера
- После оптимизации рекомендуется перезагрузить компьютер

## Решение проблем

Если у вас возникли проблемы с запуском скриптов, убедитесь, что:

1. Вы запустили bat-файл от имени администратора
2. На вашем компьютере разрешено выполнение PowerShell скриптов
3. Файлы находятся в папке с полным доступом на запись
4. Антивирус не блокирует выполнение скриптов

Подробную информацию о возникших ошибках можно найти в логах в папке `WindowsOptimizer_Logs`.

## Автор

Скрипты созданы и оптимизированы ботом оптимизации Windows.

## Что нового

### Версия 2.0 - Безопасность и Стабильность

- **Улучшенная безопасность**:
  - Добавлена система авторизации пользователей
  - Возможность ограничения доступа к боту через белый список
  - Улучшена защита конфиденциальных данных
  - Добавлен файл `SECURITY.md` с рекомендациями по безопасности

- **Стабильность и производительность**:
  - Полностью переработана архитектура кода
  - Удалены дублирующиеся функции
  - Исправлены ошибки в асинхронной обработке
  - Добавлена проверка зависимостей при запуске

- **Улучшения в авторизации**:
  - Администраторы могут добавлять новых пользователей через команду `/add_user`
  - Доступ к статистике только для администраторов
  - Гибкая настройка через переменные окружения

- **Логирование и отладка**:
  - Расширенное логирование с настраиваемым уровнем детализации
  - Сохранение логов в отдельные файлы с датой
  - Улучшенная обработка ошибок API

## Требования

- Python 3.6 или выше
- Установленные библиотеки из `requirements.txt`
- Ключи API для Telegram и Claude (Anthropic)

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:
   ```
   pip install -r requirements.txt
   ```
3. Скопируйте `example.env` в файл `.env` и настройте переменные:
   ```
   cp example.env .env
   ```
4. Отредактируйте `.env` файл, добавив ваши ключи API:
   ```
   TELEGRAM_TOKEN=ваш_токен_telegram_бота
   ANTHROPIC_API_KEY=ваш_ключ_api_claude
   
   # Опционально для ограничения доступа
   ALLOWED_USERS=ID1,ID2,ID3
   ADMIN_USER_ID=ваш_ID_администратора
   ```

## Запуск бота

Для запуска бота оптимизации Windows выполните следующие шаги:

### Подготовка перед запуском
1. **Настройте файл `.env`**
   - Скопируйте `example.env` в `.env` (если это ещё не сделано)
   - Укажите ваш Telegram токен (получите у [@BotFather](https://t.me/BotFather))
   - Укажите ваш API ключ Anthropic Claude (получите на [console.anthropic.com](https://console.anthropic.com/))
   - При необходимости настройте список разрешенных пользователей и администратора

2. **Установите зависимости**
   ```
   pip install -r requirements.txt
   ```

3. **Проверьте API ключ Anthropic**
   ```
   python check_anthropic.py
   ```
   Скрипт проверит подключение к API Anthropic и сообщит о возможных проблемах

### Запуск бота
У вас есть несколько способов запуска бота:

#### Способ 1: Через BAT-файл (рекомендуется для Windows)
- Просто дважды щёлкните на файле `start_bot.bat`
- Откроется окно командной строки с информацией о запуске

#### Способ 2: Через PowerShell
- Щёлкните правой кнопкой на файле `start_bot.ps1`
- Выберите "Запустить с помощью PowerShell"

#### Способ 3: Ручной запуск через Python
```
python optimization_bot.py
```

### Подтверждение успешного запуска
Если бот запущен успешно, вы увидите примерно такое сообщение:
```
INFO - Режим ограниченного доступа отключен. Доступ разрешен всем пользователям.
INFO - Запуск бота оптимизации Windows...
INFO - Используется модель: claude-3-5-sonnet-20240620
INFO - Бот запущен и готов принимать сообщения...
```

После этого можно открыть Telegram и отправить команду `/start` вашему боту.

## Функции бота

- Создание скриптов оптимизации Windows на основе скриншота системы
- Исправление ошибок в существующих скриптах
- Показ статистики по сгенерированным скриптам
- Управление авторизацией пользователей (для администраторов)

## Команды

- `/start` - начать взаимодействие с ботом
- `/help` - получить справку
- `/fix` - перейти в режим исправления ошибок
- `/stats` - показать статистику (только для администраторов)
- `/cancel` - отменить текущую операцию
- `/add_user` - добавить нового пользователя в белый список (только для администраторов)

## Система авторизации

Бот поддерживает два режима работы:

1. **Открытый доступ** (по умолчанию):
   - Доступ разрешен всем пользователям Telegram
   - Статистика доступна только администратору

2. **Ограниченный доступ**:
   - Доступ только для пользователей из белого списка
   - Для включения укажите ID пользователей в `ALLOWED_USERS`
   - Администратор может добавлять новых пользователей через команду `/add_user`

### Настройка ограниченного доступа

1. В файле `.env` укажите ID пользователей через запятую:
   ```
   ALLOWED_USERS=123456789,987654321
   ADMIN_USER_ID=123456789
   ```

2. Чтобы узнать свой ID в Telegram, напишите боту @userinfobot

3. Администратор может добавлять новых пользователей командой:
   ```
   /add_user 123456789 Имя Пользователя
   ```

## Решение проблем

### Проверка зависимостей

При запуске бот автоматически проверяет наличие всех необходимых зависимостей и сообщает о проблемах:

```
ERROR: Отсутствуют необходимые зависимости: anthropic, aiohttp
ERROR: Установите их с помощью команды: pip install -r requirements.txt
```

### Ошибки с API Anthropic

В проекте используется библиотека **anthropic версии 0.19.0** с новым API (`client.messages.create`). Если возникают проблемы с API, следуйте инструкциям ниже.

#### Проверка совместимости API

Для проверки корректности настройки API используйте скрипт:
```bash
python check_anthropic.py
```

Скрипт выведет информацию о текущей версии библиотеки, доступных методах API и рекомендуемых действиях.

### Подробное руководство

Для более подробной информации о решении проблем с API Anthropic смотрите файл `TROUBLESHOOTING.md`.

## Использование

1. Запустите бота в Telegram
2. Используйте команду `/start`
3. Отправьте скриншот с информацией о вашей системе (например, из окна "Система" или "Диспетчер устройств")
4. Бот отправит изображение в Claude для анализа и создаст набор скриптов оптимизации
5. Скачайте ZIP-архив со скриптами и следуйте инструкциям для их использования

## Безопасность

Для обеспечения безопасности при использовании бота:

1. **Никогда не публикуйте файл .env**:
   - Храните API-ключи в секрете
   - Используйте .gitignore для исключения файла .env из репозитория

2. **Проверяйте сгенерированные скрипты перед выполнением**:
   - Всегда просматривайте код перед запуском
   - Создавайте точку восстановления системы перед выполнением оптимизаций

3. **Ограничивайте доступ к боту**:
   - Используйте белый список пользователей в продакшн-окружении
   - Назначьте администратора для мониторинга активности

Подробнее о безопасности читайте в файле `SECURITY.md`.

## Генерируемые файлы

Каждому пользователю бот создает набор файлов:

1. **WindowsOptimizer.ps1** - основной PowerShell скрипт оптимизации
2. **Start-Optimizer.bat** - командный файл для запуска с правами администратора
3. **README.txt** - инструкция по использованию

## Структура кода

- `optimization_bot.py` - основной файл бота
- `script_validator.py` - валидатор скриптов для обнаружения и исправления ошибок
- `script_metrics.py` - система сбора и анализа метрик качества скриптов
- `prompt_optimizer.py` - самообучающаяся система улучшения промптов
- `test_scripts.py` - тестирование скриптов с примерами ошибок
- `requirements.txt` - зависимости проекта с точными версиями
- `example.env` - пример конфигурации переменных окружения
- `SECURITY.md` - рекомендации по безопасности
- `.gitignore` - исключения для системы контроля версий

## Особенности оптимизации

Сгенерированные скрипты включают следующие оптимизации:

- Очистка временных файлов и кэша системы
- Оптимизация визуальных эффектов
- Настройка плана электропитания
- Управление программами автозагрузки
- Оптимизация служб Windows
- Очистка кэша браузеров (Chrome, Firefox, Edge, Яндекс Браузер)
- Оптимизация Telegram (очистка кэша)
- Возможность отката всех изменений

## Система самообучения

Бот включает уникальную систему самообучения и улучшения скриптов:

1. **Валидация скриптов**:
   - Автоматическое обнаружение распространенных ошибок
   - Проверка синтаксиса PowerShell и Batch файлов
   - Выявление небезопасных операций и критических служб

2. **Автоматическое исправление**:
   - Исправление синтаксических ошибок
   - Добавление обработки ошибок и проверок
   - Улучшение кода для максимальной совместимости

3. **Сбор метрик**:
   - Отслеживание типов ошибок и их частоты
   - Анализ эффективности исправлений
   - Выявление паттернов для улучшения

4. **Оптимизация промптов**:
   - Автоматическое обновление шаблонов запросов к Claude
   - Добавление примеров распространенных ошибок
   - Улучшение инструкций на основе статистики

## Лицензия

Проект распространяется под лицензией MIT. См. файл LICENSE для деталей.

#   O P B O T 
 
 